

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>core.split &mdash; PySegCNN  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> PySegCNN
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../source/requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/api.html">API Reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">PySegCNN</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>core.split</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for core.split</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Split the dataset into training, validation and test set.</span>

<span class="sd">License</span>
<span class="sd">-------</span>

<span class="sd">    Copyright (c) 2020 Daniel Frisinghelli</span>

<span class="sd">    This source code is licensed under the GNU General Public License v3.</span>

<span class="sd">    See the LICENSE file in the repository&#39;s root directory.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># !/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># builtins</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">enum</span>

<span class="c1"># externals</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">torch.utils.data.dataset</span> <span class="kn">import</span> <span class="n">Subset</span>

<span class="c1"># the names of the subsets</span>
<span class="n">SUBSET_NAMES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;valid&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_ds_len</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ratio</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calcute number of samples in a dataset given a ratio.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ds : `collections.Sized`</span>
<span class="sd">        An object with a __len__ attribute.</span>
<span class="sd">    ratio : `float`</span>
<span class="sd">        A ratio to multiply with the length of ``ds``.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    n_samples: `int`</span>
<span class="sd">        Length of ``ds`` * ``ratio``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">))</span>


<div class="viewcode-block" id="random_tile_split"><a class="viewcode-back" href="../../source/core.html#core.split.random_tile_split">[docs]</a><span class="k">def</span> <span class="nf">random_tile_split</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">tvratio</span><span class="p">,</span> <span class="n">ttratio</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Randomly split the tiles of a dataset.</span>

<span class="sd">    For each scene, the tiles of the scene can be distributed among the</span>
<span class="sd">    training, validation and test set.</span>

<span class="sd">    The parameters ``ttratio`` and ``tvratio`` control the size of the</span>
<span class="sd">    training, validation and test datasets.</span>

<span class="sd">    Test dataset size      : (1 - ``ttratio``) * len(``ds``)</span>
<span class="sd">    Train dataset size     : ``ttratio`` * ``tvratio`` * len(``ds``)</span>
<span class="sd">    Validation dataset size: ``ttratio`` * (1 - ``tvratio``) * len(``ds``)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ds : `pysegcnn.core.dataset.ImageDataset`</span>
<span class="sd">        An instance of `~pysegcnn.core.dataset.ImageDataset`.</span>
<span class="sd">    tvratio : `float`</span>
<span class="sd">        The ratio of training data to validation data, e.g. ``tvratio`` = 0.8</span>
<span class="sd">        means 80% training, 20% validation.</span>
<span class="sd">    ttratio : `float`, optional</span>
<span class="sd">        The ratio of training and validation data to test data, e.g.</span>
<span class="sd">        ``ttratio`` = 0.6 means 60% for training and validation, 40% for</span>
<span class="sd">        testing. The default is 1.</span>
<span class="sd">    seed : `int`, optional</span>
<span class="sd">        The random seed for reproducibility. The default is 0.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    AssertionError</span>
<span class="sd">        Raised if the splits are not pairwise disjoint.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    subsets : `dict`</span>
<span class="sd">        Subset dictionary with keys:</span>
<span class="sd">            ``&#39;train&#39;``</span>
<span class="sd">                dictionary containing the training scenes.</span>
<span class="sd">            ``&#39;valid&#39;``</span>
<span class="sd">                dictionary containing the validation scenes.</span>
<span class="sd">            ``&#39;test&#39;``</span>
<span class="sd">                dictionary containing the test scenes.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># set the random seed for reproducibility</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

    <span class="c1"># randomly permute indices to access dataset</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="p">))</span>

    <span class="c1"># length of the training and validation dataset</span>
    <span class="c1"># number of samples: (ttratio * len(ds))</span>
    <span class="n">trav_len</span> <span class="o">=</span> <span class="n">_ds_len</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">ttratio</span><span class="p">)</span>
    <span class="n">trav_indices</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[:</span><span class="n">trav_len</span><span class="p">]</span>

    <span class="c1"># length of the training dataset</span>
    <span class="c1"># number of samples: (ttratio * tvratio * len(ds))</span>
    <span class="n">train_len</span> <span class="o">=</span> <span class="n">_ds_len</span><span class="p">(</span><span class="n">trav_indices</span><span class="p">,</span> <span class="n">tvratio</span><span class="p">)</span>
    <span class="n">train_ind</span> <span class="o">=</span> <span class="n">trav_indices</span><span class="p">[:</span><span class="n">train_len</span><span class="p">]</span>

    <span class="c1"># length of the validation dataset</span>
    <span class="c1"># number of samples: (ttratio * (1- tvratio) * len(ds))</span>
    <span class="n">valid_ind</span> <span class="o">=</span> <span class="n">trav_indices</span><span class="p">[</span><span class="n">train_len</span><span class="p">:]</span>

    <span class="c1"># length of the test dataset</span>
    <span class="c1"># number of samples: ((1 - ttratio) * len(ds))</span>
    <span class="n">test_ind</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">trav_len</span><span class="p">:]</span>

    <span class="c1"># get the tiles of the scenes of each dataset</span>
    <span class="n">subsets</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">train_ind</span><span class="p">,</span> <span class="n">valid_ind</span><span class="p">,</span> <span class="n">test_ind</span><span class="p">]):</span>

        <span class="c1"># store the indices and corresponding tiles of the current subset to</span>
        <span class="c1"># dictionary</span>
        <span class="n">subsets</span><span class="p">[</span><span class="n">SUBSET_NAMES</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">ds</span><span class="o">.</span><span class="n">scenes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">}</span>

    <span class="c1"># check if the splits are disjoint</span>
    <span class="k">assert</span> <span class="n">pairwise_disjoint</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subsets</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>

    <span class="k">return</span> <span class="n">subsets</span></div>


<div class="viewcode-block" id="random_scene_split"><a class="viewcode-back" href="../../source/core.html#core.split.random_scene_split">[docs]</a><span class="k">def</span> <span class="nf">random_scene_split</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">tvratio</span><span class="p">,</span> <span class="n">ttratio</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Randomly split the tiles of a dataset.</span>

<span class="sd">    For each scene, all the tiles of the scene are included in either the</span>
<span class="sd">    training, validation or test set, respectively.</span>

<span class="sd">    The parameters ``ttratio`` and ``tvratio`` control the size of the</span>
<span class="sd">    training, validation and test datasets.</span>

<span class="sd">    Test dataset size      : (1 - ``ttratio``) * len(``ds``)</span>
<span class="sd">    Train dataset size     : ``ttratio`` * ``tvratio`` * len(``ds``)</span>
<span class="sd">    Validation dataset size: ``ttratio`` * (1 - ``tvratio``) * len(``ds``)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ds : `pysegcnn.core.dataset.ImageDataset`</span>
<span class="sd">        An instance of `~pysegcnn.core.dataset.ImageDataset`.</span>
<span class="sd">    tvratio : `float`</span>
<span class="sd">        The ratio of training data to validation data, e.g. ``tvratio`` = 0.8</span>
<span class="sd">        means 80% training, 20% validation.</span>
<span class="sd">    ttratio : `float`, optional</span>
<span class="sd">        The ratio of training and validation data to test data, e.g.</span>
<span class="sd">        ``ttratio`` = 0.6 means 60% for training and validation, 40% for</span>
<span class="sd">        testing. The default is 1.</span>
<span class="sd">    seed : `int`, optional</span>
<span class="sd">        The random seed for reproducibility. The default is 0.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    AssertionError</span>
<span class="sd">        Raised if the splits are not pairwise disjoint.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    subsets : `dict`</span>
<span class="sd">        Subset dictionary with keys:</span>
<span class="sd">            ``&#39;train&#39;``</span>
<span class="sd">                dictionary containing the training scenes.</span>
<span class="sd">            ``&#39;valid&#39;``</span>
<span class="sd">                dictionary containing the validation scenes.</span>
<span class="sd">            ``&#39;test&#39;``</span>
<span class="sd">                dictionary containing the test scenes.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># set the random seed for reproducibility</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

    <span class="c1"># get the names of the scenes and generate random permutation</span>
    <span class="n">scene_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">([</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">scenes</span><span class="p">]))</span>

    <span class="c1"># the training and validation scenes</span>
    <span class="c1"># number of samples: (ttratio * nscenes)</span>
    <span class="n">trav_len</span> <span class="o">=</span> <span class="n">_ds_len</span><span class="p">(</span><span class="n">scene_ids</span><span class="p">,</span> <span class="n">ttratio</span><span class="p">)</span>
    <span class="n">trav_scenes</span> <span class="o">=</span> <span class="n">scene_ids</span><span class="p">[:</span><span class="n">trav_len</span><span class="p">]</span>

    <span class="c1"># the training scenes</span>
    <span class="c1"># number of samples: (ttratio * tvratio * nscenes)</span>
    <span class="n">train_len</span> <span class="o">=</span> <span class="n">_ds_len</span><span class="p">(</span><span class="n">trav_scenes</span><span class="p">,</span> <span class="n">tvratio</span><span class="p">)</span>
    <span class="n">train_scenes</span> <span class="o">=</span> <span class="n">trav_scenes</span><span class="p">[:</span><span class="n">train_len</span><span class="p">]</span>

    <span class="c1"># the validation scenes</span>
    <span class="c1"># number of samples: (ttratio * (1- tvratio) * nscenes)</span>
    <span class="n">valid_scenes</span> <span class="o">=</span> <span class="n">trav_scenes</span><span class="p">[</span><span class="n">train_len</span><span class="p">:]</span>

    <span class="c1"># the test scenes</span>
    <span class="c1"># number of samples:((1 - ttratio) * nscenes)</span>
    <span class="n">test_scenes</span> <span class="o">=</span> <span class="n">scene_ids</span><span class="p">[</span><span class="n">trav_len</span><span class="p">:]</span>

    <span class="c1"># get the tiles of the scenes of each dataset</span>
    <span class="n">subsets</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">train_scenes</span><span class="p">,</span> <span class="n">valid_scenes</span><span class="p">,</span> <span class="n">test_scenes</span><span class="p">]):</span>

        <span class="c1"># store the indices and corresponding tiles of the current subset to</span>
        <span class="c1"># dictionary</span>
        <span class="n">subsets</span><span class="p">[</span><span class="n">SUBSET_NAMES</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">scenes</span><span class="p">)</span>
                                       <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">}</span>

    <span class="c1"># check if the splits are disjoint</span>
    <span class="k">assert</span> <span class="n">pairwise_disjoint</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subsets</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>

    <span class="k">return</span> <span class="n">subsets</span></div>


<span class="c1"># split the scenes of a dataset based on a date, useful for time series data</span>
<span class="c1"># scenes before date build the training set, scenes after the date build the</span>
<span class="c1"># validation set, the test set is empty</span>
<div class="viewcode-block" id="date_scene_split"><a class="viewcode-back" href="../../source/core.html#core.split.date_scene_split">[docs]</a><span class="k">def</span> <span class="nf">date_scene_split</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">dateformat</span><span class="o">=</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split the dataset based on a date.</span>

<span class="sd">    Scenes before ``date`` build the training set, scenes after ``date`` build</span>
<span class="sd">    the validation set, the test set is empty.</span>

<span class="sd">    Useful for time series data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ds : `pysegcnn.core.dataset.ImageDataset`</span>
<span class="sd">        An instance of `~pysegcnn.core.dataset.ImageDataset`.</span>
<span class="sd">    date : `str`</span>
<span class="sd">        A date.</span>
<span class="sd">    dateformat : `str`, optional</span>
<span class="sd">        The format of ``date``. ``dateformat`` is used by</span>
<span class="sd">        `datetime.datetime.strptime&#39; to parse ``date`` to a `datetime.datetime`</span>
<span class="sd">        object. The default is &#39;%Y%m%d&#39;.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    AssertionError</span>
<span class="sd">        Raised if the splits are not pairwise disjoint.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    subsets : `dict`</span>
<span class="sd">        Subset dictionary with keys:</span>
<span class="sd">            ``&#39;train&#39;``</span>
<span class="sd">                dictionary containing the training scenes.</span>
<span class="sd">            ``&#39;valid&#39;``</span>
<span class="sd">                dictionary containing the validation scenes.</span>
<span class="sd">            ``&#39;test&#39;``</span>
<span class="sd">                dictionary containing the test scenes, empty.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># convert date to datetime object</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">dateformat</span><span class="p">)</span>

    <span class="c1"># the training, validation and test scenes</span>
    <span class="n">train_scenes</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">s</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">scenes</span><span class="p">)</span> <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">date</span><span class="p">}</span>
    <span class="n">valid_scenes</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">s</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">scenes</span><span class="p">)</span> <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">date</span><span class="p">}</span>
    <span class="n">test_scenes</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># build the training and test datasets</span>
    <span class="n">subsets</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">scenes</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">train_scenes</span><span class="p">,</span> <span class="n">valid_scenes</span><span class="p">,</span> <span class="n">test_scenes</span><span class="p">]):</span>

        <span class="c1"># store the indices and corresponding tiles of the current subset to</span>
        <span class="c1"># dictionary</span>
        <span class="n">subsets</span><span class="p">[</span><span class="n">SUBSET_NAMES</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span> <span class="o">=</span> <span class="n">scenes</span>

    <span class="c1"># check if the splits are disjoint</span>
    <span class="k">assert</span> <span class="n">pairwise_disjoint</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subsets</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>

    <span class="k">return</span> <span class="n">subsets</span></div>


<div class="viewcode-block" id="pairwise_disjoint"><a class="viewcode-back" href="../../source/core.html#core.split.pairwise_disjoint">[docs]</a><span class="k">def</span> <span class="nf">pairwise_disjoint</span><span class="p">(</span><span class="n">sets</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check if ``sets`` are pairwise disjoint.</span>

<span class="sd">    Sets are pairwise disjoint if the length of their union equals the sum of</span>
<span class="sd">    their lengths.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sets : `list` [`collections.Sized`]</span>
<span class="sd">        A list of sized objects.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    disjoint : `bool`</span>
<span class="sd">        Whether the sets are pairwise disjoint.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">union</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="n">sets</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">sets</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">n</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">union</span><span class="p">)</span></div>


<div class="viewcode-block" id="CustomSubset"><a class="viewcode-back" href="../../source/core.html#core.split.CustomSubset">[docs]</a><span class="k">class</span> <span class="nc">CustomSubset</span><span class="p">(</span><span class="n">Subset</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Custom subset inheriting `torch.utils.data.Subset`.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Representation of ``~pysegcnn.core.split.CustomSubset``.&quot;&quot;&quot;</span>
        <span class="c1"># representation string</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="s1">&#39;- </span><span class="si">{}</span><span class="s1">: </span><span class="si">{:d}</span><span class="s1"> tiles (</span><span class="si">{:.2f}</span><span class="s1">%)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scenes</span><span class="p">),</span> <span class="mi">100</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scenes</span><span class="p">)</span> <span class="o">/</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">fs</span></div>


<div class="viewcode-block" id="SceneSubset"><a class="viewcode-back" href="../../source/core.html#core.split.SceneSubset">[docs]</a><span class="k">class</span> <span class="nc">SceneSubset</span><span class="p">(</span><span class="n">CustomSubset</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A custom subset for dataset splits where the scenes are preserved.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ds : `pysegcnn.core.dataset.ImageDataset`</span>
<span class="sd">        An instance of `~pysegcnn.core.dataset.ImageDataset`.</span>
<span class="sd">    indices : `list` [`int`]</span>
<span class="sd">        List of the subset indices to access ``ds``.</span>
<span class="sd">    name : `str`</span>
<span class="sd">        Name of the subset.</span>
<span class="sd">    scenes : `list` [`dict`]</span>
<span class="sd">        List of the subset tiles.</span>
<span class="sd">    scene_ids : `list` or `numpy.ndarray`</span>
<span class="sd">        Container of the scene ids.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">scenes</span><span class="p">,</span> <span class="n">scene_ids</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">)</span>

        <span class="c1"># the name of the subset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

        <span class="c1"># the scene in the subset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scenes</span> <span class="o">=</span> <span class="n">scenes</span>

        <span class="c1"># the names of the scenes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ids</span> <span class="o">=</span> <span class="n">scene_ids</span></div>


<div class="viewcode-block" id="RandomSubset"><a class="viewcode-back" href="../../source/core.html#core.split.RandomSubset">[docs]</a><span class="k">class</span> <span class="nc">RandomSubset</span><span class="p">(</span><span class="n">CustomSubset</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A custom subset for random dataset splits.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ds : `pysegcnn.core.dataset.ImageDataset`</span>
<span class="sd">        An instance of `~pysegcnn.core.dataset.ImageDataset`.</span>
<span class="sd">    indices : `list` [`int`]</span>
<span class="sd">        List of the subset indices to access ``ds``.</span>
<span class="sd">    name : `str`</span>
<span class="sd">        Name of the subset.</span>
<span class="sd">    scenes : `list` [`dict`]</span>
<span class="sd">        List of the subset tiles.</span>
<span class="sd">    scene_ids : `list` or `numpy.ndarray`</span>
<span class="sd">        Container of the scene ids.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">scenes</span><span class="p">,</span> <span class="n">scene_ids</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">)</span>

        <span class="c1"># the name of the subset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

        <span class="c1"># the scene in the subset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scenes</span> <span class="o">=</span> <span class="n">scenes</span></div>


<div class="viewcode-block" id="Split"><a class="viewcode-back" href="../../source/core.html#core.split.Split">[docs]</a><span class="k">class</span> <span class="nc">Split</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generic class handling how ``ds`` is split.</span>

<span class="sd">    Inherit `~pysegcnn.core.split.Split` and implement the</span>
<span class="sd">    `~pysegcnn.core.split.Split.subsets` and</span>
<span class="sd">    `~pysegcnn.core.split.Split.subset_type` method.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ds : `pysegcnn.core.dataset.ImageDataset`</span>
<span class="sd">        An instance of `~pysegcnn.core.dataset.ImageDataset`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>

        <span class="c1"># the dataset to split</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span>

<div class="viewcode-block" id="Split.split"><a class="viewcode-back" href="../../source/core.html#core.split.Split.split">[docs]</a>    <span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Split dataset into training, validation and test set.</span>

<span class="sd">        `~pysegcnn.core.split.Split.split` works only if</span>
<span class="sd">        `~pysegcnn.core.split.Split.subsets` and</span>
<span class="sd">        `~pysegcnn.core.split.Split.subset_type` are implemented.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># build the subsets</span>
        <span class="n">ds_split</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">sub</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsets</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="c1"># the scene identifiers of the current subset</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">([</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sub</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>

            <span class="c1"># build the subset</span>
            <span class="n">sbst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subset_type</span><span class="p">()(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">sub</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">name</span><span class="p">,</span>
                                      <span class="nb">list</span><span class="p">(</span><span class="n">sub</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">ids</span><span class="p">)</span>
            <span class="n">ds_split</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sbst</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ds_split</span></div>

<div class="viewcode-block" id="Split.subsets"><a class="viewcode-back" href="../../source/core.html#core.split.Split.subsets">[docs]</a>    <span class="k">def</span> <span class="nf">subsets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Define training, validation and test sets.</span>

<span class="sd">        Wrapper method for</span>
<span class="sd">        `pysegcnn.core.split.Split.random_tile_split`,</span>
<span class="sd">        `pysegcnn.core.split.Split.random_scene_split` or</span>
<span class="sd">        `pysegcnn.core.split.Split.date_scene_split`.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        NotImplementedError</span>
<span class="sd">            Raised if `pysegcnn.core.split.Split` is not inherited.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="Split.subset_type"><a class="viewcode-back" href="../../source/core.html#core.split.Split.subset_type">[docs]</a>    <span class="k">def</span> <span class="nf">subset_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Define the type of each subset.</span>

<span class="sd">        Wrapper method for</span>
<span class="sd">        `pysegcnn.core.split.RandomSubset` or</span>
<span class="sd">        `pysegcnn.core.split.SceneSubset`.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        NotImplementedError</span>
<span class="sd">            Raised if `pysegcnn.core.split.Split` is not inherited.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div></div>


<div class="viewcode-block" id="DateSplit"><a class="viewcode-back" href="../../source/core.html#core.split.DateSplit">[docs]</a><span class="k">class</span> <span class="nc">DateSplit</span><span class="p">(</span><span class="n">Split</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split the dataset based on a date.</span>

<span class="sd">    Class wrapper for `pysegcnn.core.split.Split.date_scene_split`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ds : `pysegcnn.core.dataset.ImageDataset`</span>
<span class="sd">        An instance of `~pysegcnn.core.dataset.ImageDataset`.</span>
<span class="sd">    date : &#39;str&#39;</span>
<span class="sd">        A date.</span>
<span class="sd">    dateformat : &#39;str&#39;, optional</span>
<span class="sd">        The format of ``date``. ``dateformat`` is used by</span>
<span class="sd">        `datetime.datetime.strptime&#39; to parse ``date`` to a `datetime.datetime`</span>
<span class="sd">        object. The default is &#39;%Y%m%d&#39;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">dateformat</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>

        <span class="c1"># the date to split the dataset</span>
        <span class="c1"># before: training set</span>
        <span class="c1"># after : validation set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">date</span>

        <span class="c1"># the format of the date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dateformat</span> <span class="o">=</span> <span class="n">dateformat</span>

<div class="viewcode-block" id="DateSplit.subsets"><a class="viewcode-back" href="../../source/core.html#core.split.DateSplit.subsets">[docs]</a>    <span class="k">def</span> <span class="nf">subsets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrap `pysegcnn.core.split.Split.date_scene_split`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        subsets : `dict`</span>
<span class="sd">            Subset dictionary with keys:</span>
<span class="sd">                ``&#39;train&#39;``</span>
<span class="sd">                    dictionary containing the training scenes.</span>
<span class="sd">                ``&#39;valid&#39;``</span>
<span class="sd">                    dictionary containing the validation scenes.</span>
<span class="sd">                ``&#39;test&#39;``</span>
<span class="sd">                    dictionary containing the test scenes, empty.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">date_scene_split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dateformat</span><span class="p">)</span></div>

<div class="viewcode-block" id="DateSplit.subset_type"><a class="viewcode-back" href="../../source/core.html#core.split.DateSplit.subset_type">[docs]</a>    <span class="k">def</span> <span class="nf">subset_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrap `pysegcnn.core.split.SceneSubset`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        SceneSubset : `pysegcnn.core.split.SceneSubset`</span>
<span class="sd">            The subset type.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SceneSubset</span></div></div>


<div class="viewcode-block" id="RandomSplit"><a class="viewcode-back" href="../../source/core.html#core.split.RandomSplit">[docs]</a><span class="k">class</span> <span class="nc">RandomSplit</span><span class="p">(</span><span class="n">Split</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Randomly split the dataset.</span>

<span class="sd">    Generic class for random dataset splits.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ds : `pysegcnn.core.dataset.ImageDataset`</span>
<span class="sd">        An instance of `~pysegcnn.core.dataset.ImageDataset`.</span>
<span class="sd">    tvratio : `float`</span>
<span class="sd">        The ratio of training data to validation data, e.g. ``tvratio`` = 0.8</span>
<span class="sd">        means 80% training, 20% validation.</span>
<span class="sd">    ttratio : `float`, optional</span>
<span class="sd">        The ratio of training and validation data to test data, e.g.</span>
<span class="sd">        ``ttratio`` = 0.6 means 60% for training and validation, 40% for</span>
<span class="sd">        testing. The default is 1.</span>
<span class="sd">    seed : `int`, optional</span>
<span class="sd">        The random seed for reproducibility. The default is 0.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">ttratio</span><span class="p">,</span> <span class="n">tvratio</span><span class="p">,</span> <span class="n">seed</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>

        <span class="c1"># the training, validation and test set ratios</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ttratio</span> <span class="o">=</span> <span class="n">ttratio</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tvratio</span> <span class="o">=</span> <span class="n">tvratio</span>

        <span class="c1"># the random seed: useful for reproducibility</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span></div>


<div class="viewcode-block" id="RandomTileSplit"><a class="viewcode-back" href="../../source/core.html#core.split.RandomTileSplit">[docs]</a><span class="k">class</span> <span class="nc">RandomTileSplit</span><span class="p">(</span><span class="n">RandomSplit</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Randomly split the dataset.</span>

<span class="sd">    For each scene, the tiles of the scene can be distributed among the</span>
<span class="sd">    training, validation and test set.</span>

<span class="sd">    Class wrapper for `pysegcnn.core.split.Split.random_tile_split`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ds : `pysegcnn.core.dataset.ImageDataset`</span>
<span class="sd">        An instance of `~pysegcnn.core.dataset.ImageDataset`.</span>
<span class="sd">    tvratio : `float`</span>
<span class="sd">        The ratio of training data to validation data, e.g. ``tvratio`` = 0.8</span>
<span class="sd">        means 80% training, 20% validation.</span>
<span class="sd">    ttratio : `float`, optional</span>
<span class="sd">        The ratio of training and validation data to test data, e.g.</span>
<span class="sd">        ``ttratio`` = 0.6 means 60% for training and validation, 40% for</span>
<span class="sd">        testing. The default is 1.</span>
<span class="sd">    seed : `int`, optional</span>
<span class="sd">        The random seed for reproducibility. The default is 0.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">ttratio</span><span class="p">,</span> <span class="n">tvratio</span><span class="p">,</span> <span class="n">seed</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ttratio</span><span class="p">,</span> <span class="n">tvratio</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>

<div class="viewcode-block" id="RandomTileSplit.subsets"><a class="viewcode-back" href="../../source/core.html#core.split.RandomTileSplit.subsets">[docs]</a>    <span class="k">def</span> <span class="nf">subsets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrap `pysegcnn.core.split.Split.random_tile_split`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        subsets : `dict`</span>
<span class="sd">            Subset dictionary with keys:</span>
<span class="sd">                ``&#39;train&#39;``</span>
<span class="sd">                    dictionary containing the training scenes.</span>
<span class="sd">                ``&#39;valid&#39;``</span>
<span class="sd">                    dictionary containing the validation scenes.</span>
<span class="sd">                ``&#39;test&#39;``</span>
<span class="sd">                    dictionary containing the test scenes, empty.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">random_tile_split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tvratio</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ttratio</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span></div>

<div class="viewcode-block" id="RandomTileSplit.subset_type"><a class="viewcode-back" href="../../source/core.html#core.split.RandomTileSplit.subset_type">[docs]</a>    <span class="k">def</span> <span class="nf">subset_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrap `pysegcnn.core.split.RandomSubset`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        SceneSubset : `pysegcnn.core.split.RandomSubset`</span>
<span class="sd">            The subset type.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">RandomSubset</span></div></div>


<div class="viewcode-block" id="RandomSceneSplit"><a class="viewcode-back" href="../../source/core.html#core.split.RandomSceneSplit">[docs]</a><span class="k">class</span> <span class="nc">RandomSceneSplit</span><span class="p">(</span><span class="n">RandomSplit</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Randomly split the dataset.</span>

<span class="sd">    For each scene, all the tiles of the scene are included in either the</span>
<span class="sd">    training, validation or test set, respectively.</span>

<span class="sd">    Class wrapper for `pysegcnn.core.split.Split.random_scene_split`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ds : `pysegcnn.core.dataset.ImageDataset`</span>
<span class="sd">        An instance of `~pysegcnn.core.dataset.ImageDataset`.</span>
<span class="sd">    tvratio : `float`</span>
<span class="sd">        The ratio of training data to validation data, e.g. ``tvratio`` = 0.8</span>
<span class="sd">        means 80% training, 20% validation.</span>
<span class="sd">    ttratio : `float`, optional</span>
<span class="sd">        The ratio of training and validation data to test data, e.g.</span>
<span class="sd">        ``ttratio`` = 0.6 means 60% for training and validation, 40% for</span>
<span class="sd">        testing. The default is 1.</span>
<span class="sd">    seed : `int`, optional</span>
<span class="sd">        The random seed for reproducibility. The default is 0.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">ttratio</span><span class="p">,</span> <span class="n">tvratio</span><span class="p">,</span> <span class="n">seed</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ttratio</span><span class="p">,</span> <span class="n">tvratio</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>

<div class="viewcode-block" id="RandomSceneSplit.subsets"><a class="viewcode-back" href="../../source/core.html#core.split.RandomSceneSplit.subsets">[docs]</a>    <span class="k">def</span> <span class="nf">subsets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrap `pysegcnn.core.split.Split.random_scene_split`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        subsets : `dict`</span>
<span class="sd">            Subset dictionary with keys:</span>
<span class="sd">                ``&#39;train&#39;``</span>
<span class="sd">                    dictionary containing the training scenes.</span>
<span class="sd">                ``&#39;valid&#39;``</span>
<span class="sd">                    dictionary containing the validation scenes.</span>
<span class="sd">                ``&#39;test&#39;``</span>
<span class="sd">                    dictionary containing the test scenes, empty.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">random_scene_split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tvratio</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ttratio</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span></div>

<div class="viewcode-block" id="RandomSceneSplit.subset_type"><a class="viewcode-back" href="../../source/core.html#core.split.RandomSceneSplit.subset_type">[docs]</a>    <span class="k">def</span> <span class="nf">subset_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrap `pysegcnn.core.split.SceneSubset`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        SceneSubset : `pysegcnn.core.split.SceneSubset`</span>
<span class="sd">            The subset type.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SceneSubset</span></div></div>


<div class="viewcode-block" id="SupportedSplits"><a class="viewcode-back" href="../../source/core.html#core.split.SupportedSplits">[docs]</a><span class="k">class</span> <span class="nc">SupportedSplits</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Names and corresponding classes of the implemented split modes.&quot;&quot;&quot;</span>

    <span class="n">random</span> <span class="o">=</span> <span class="n">RandomTileSplit</span>
    <span class="n">scene</span> <span class="o">=</span> <span class="n">RandomSceneSplit</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">DateSplit</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Daniel Frisinghelli

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>